import{q as G,j as e,a as S,t as H,v as d,w as P,S as J,i as Q,x as W,y as X,I as Y,z as Z}from"./index-qhVhRjpo.js";import{r,u as ee}from"./vendor-react-BjLkUuqo.js";import"./vendor-firebase-D6pLxh_h.js";const ae=(u={})=>{const[m,p]=r.useState(u),[t,f]=r.useState(!1),[x,g]=r.useState(null),v=(o,h)=>{p(n=>({...n,[o]:h}))},l=async()=>{f(!0),g(null);try{const o=Object.values(m).map(async n=>n?await G(n):null);return(await Promise.all(o)).filter(n=>n!==null)}catch(o){throw console.error("Upload failed",o),g("Error subiendo las imágenes."),o}finally{f(!1)}},j=()=>Object.values(m).filter(Boolean).length,y=o=>j()>=o;return{photos:m,setPhoto:v,uploadAllPhotos:l,uploading:t,error:x,count:j(),isComplete:y}},oe=()=>{const u=ee(),[m,p]=r.useState("info"),[t,f]=r.useState({year:"",make:"",model:"",mileage:"",condition:"good",vin:""}),{photos:x,setPhoto:g,uploadAllPhotos:v,count:l}=ae({front:null,back:null,interior:null,dashboard:null}),[j,y]=r.useState(!1),[o,h]=r.useState(""),[n,z]=r.useState(!1),[c,U]=r.useState(null),[w,V]=r.useState({min:0,max:0}),[O,E]=r.useState([]),N=a=>{f({...t,[a.target.name]:a.target.value})},R=(a,s)=>{s.target.files&&s.target.files[0]&&g(a,s.target.files[0])},$=l/4*100,D=a=>new Promise((s,k)=>{const b=new FileReader;b.readAsDataURL(a),b.onload=()=>s(b.result),b.onerror=A=>k(A)}),F=async()=>{y(!0),h("Subiendo fotos...");try{const s=["front","back","interior","dashboard"].map(i=>x[i]).filter(i=>i!==null);if(s.length<4)throw new Error("Missing photos");const k=s.map(i=>D(i)),A=(await Promise.all(k)).map(i=>i.split(",")[1]);h("Analizando Carrocería con IA...");const T=v(),L=Z(A),B=new Promise(i=>setTimeout(i,3500)),[_,C,te]=await Promise.all([T,L,B]);E(_),U(C);const I=15e3,K=Math.round(I*C.estimatedValueAdjustment),q=Math.round((I+2500)*C.estimatedValueAdjustment);V({min:K,max:q}),z(!0)}catch(a){console.error("Scan/Upload failed",a),alert("Hubo un error al procesar las imágenes. Por favor intenta de nuevo.")}finally{y(!1)}},M=()=>{switch(m){case"info":return e.jsxs(d.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white mb-6",children:"Detalles del Vehículo"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Año"}),e.jsx("input",{type:"number",name:"year",value:t.year,onChange:N,className:"w-full bg-slate-100 dark:bg-slate-700 p-3 rounded-xl outline-none focus:ring-2 focus:ring-[#00aed9]",placeholder:"2018"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Marca"}),e.jsx("input",{type:"text",name:"make",value:t.make,onChange:N,className:"w-full bg-slate-100 dark:bg-slate-700 p-3 rounded-xl outline-none focus:ring-2 focus:ring-[#00aed9]",placeholder:"Toyota"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Modelo"}),e.jsx("input",{type:"text",name:"model",value:t.model,onChange:N,className:"w-full bg-slate-100 dark:bg-slate-700 p-3 rounded-xl outline-none focus:ring-2 focus:ring-[#00aed9]",placeholder:"Camry SE"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Kilometraje"}),e.jsx("input",{type:"number",name:"mileage",value:t.mileage,onChange:N,className:"w-full bg-slate-100 dark:bg-slate-700 p-3 rounded-xl outline-none focus:ring-2 focus:ring-[#00aed9]",placeholder:"45000"})]})]}),e.jsxs("button",{onClick:()=>p("photos"),className:"w-full py-4 bg-[#00aed9] text-white rounded-xl font-bold uppercase tracking-widest shadow-lg shadow-cyan-500/20 active:scale-95 transition-transform flex items-center justify-center gap-2",children:["Siguiente Paso ",e.jsx(S,{size:18})]})]},"info");case"photos":return e.jsxs(d.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Fotos del Vehículo"}),e.jsxs("span",{className:`text-xs font-black uppercase px-2 py-1 rounded-lg ${l===4?"bg-emerald-500/10 text-emerald-500":"bg-slate-100 dark:bg-slate-800 text-slate-500"}`,children:["Fotos: ",l,"/4"]})]}),e.jsx("div",{className:"w-full bg-slate-100 dark:bg-slate-800 h-2 rounded-full overflow-hidden mb-6",children:e.jsx("div",{className:`h-full transition-all duration-500 ${l===4?"bg-emerald-500":"bg-[#00aed9]"}`,style:{width:`${$}%`}})}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.keys(x).map(a=>e.jsxs("label",{className:`aspect-square rounded-2xl border-2 border-dashed flex flex-col items-center justify-center cursor-pointer transition-all relative overflow-hidden group ${x[a]?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/20":"border-slate-300 dark:border-slate-700 hover:border-[#00aed9] hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[x[a]?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:URL.createObjectURL(x[a]),className:"absolute inset-0 w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"bg-white/20 backdrop-blur-md p-2 rounded-full",children:e.jsx(P,{className:"text-white drop-shadow-md",size:32})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"text-slate-400 mb-2 group-hover:text-[#00aed9] group-hover:scale-110 transition-all",size:24}),e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-400",children:a})]}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>R(a,s)})]},a))}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl flex gap-3 text-blue-600 dark:text-blue-300 text-xs",children:[e.jsx(Y,{className:"shrink-0",size:16}),e.jsx("p",{children:"Toma fotos claras y bien iluminadas para obtener la mejor oferta posible."})]}),e.jsxs("button",{onClick:()=>{l===4&&p("scan")},disabled:l<4,className:"w-full py-4 bg-[#00aed9] disabled:bg-slate-300 disabled:cursor-not-allowed text-white rounded-xl font-bold uppercase tracking-widest shadow-lg shadow-cyan-500/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[l<4?`Faltan Fotos(${l}/4)`:"Analizar Vehículo",l===4&&e.jsx(S,{size:18})]})]},"photos");case"scan":return e.jsxs(d.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"flex flex-col items-center justify-center py-10 space-y-8",children:[e.jsxs("div",{className:"relative w-64 h-64",children:[e.jsx(d.div,{animate:{rotate:360},transition:{duration:4,repeat:1/0,ease:"linear"},className:"absolute inset-0 border-4 border-dashed border-[#00aed9]/30 rounded-full"}),e.jsx(d.div,{animate:{rotate:-360},transition:{duration:3,repeat:1/0,ease:"linear"},className:"absolute inset-4 border-4 border-dashed border-[#00aed9]/50 rounded-full"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(W,{className:"text-[#00aed9] w-24 h-24 opacity-80 animate-pulse"})}),e.jsx(d.div,{animate:{top:["0%","100%","0%"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"absolute left-0 right-0 h-1 bg-[#00aed9] shadow-[0_0_20px_#00aed9]"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-2xl font-black uppercase text-slate-800 dark:text-white animate-pulse",children:n?"Análisis Completado":o||"Iniciando Escáner..."}),e.jsx("p",{className:"text-sm text-slate-500",children:n?"Generando tu oferta final...":"Nuestra IA está detectando daños y condiciones."})]}),!j&&!n&&e.jsx("button",{onClick:F,className:"px-8 py-3 bg-[#0d2232] text-white rounded-full font-bold uppercase tracking-widest text-xs animate-in fade-in slide-in-from-bottom-4",children:"Iniciar Escaneo IA"}),n&&e.jsx(d.button,{initial:{scale:0},animate:{scale:1},onClick:()=>p("offer"),className:"px-8 py-4 bg-emerald-500 text-white rounded-full font-black uppercase tracking-widest text-sm shadow-xl shadow-emerald-500/30 hover:scale-105 transition-transform",children:"Ver Oferta"})]},"scan");case"offer":return e.jsxs(d.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"text-center space-y-8 py-6",children:[e.jsx("div",{className:"inline-block p-4 bg-emerald-100 dark:bg-emerald-900/30 rounded-full text-emerald-600 mb-4",children:e.jsx(P,{size:48})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest mb-2",children:"Oferta Estimada"}),e.jsxs("div",{className:"text-5xl font-black text-slate-900 dark:text-white tracking-tighter",children:["$",w.min.toLocaleString()," - $",w.max.toLocaleString()]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-6 rounded-2xl text-left space-y-4 shadow-inner border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(J,{className:"text-amber-400",size:20,fill:"currentColor"}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:"Reporte de Inspección IA"})]}),c&&e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Condición Detectada:"}),e.jsx("span",{className:"font-bold px-2 py-0.5 rounded bg-slate-200 dark:bg-slate-700 uppercase text-xs",children:c.condition})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 block mb-1",children:"Observaciones:"}),e.jsxs("p",{className:"text-slate-700 dark:text-slate-300 italic",children:['"',c.reasoning,'"']})]}),c.defects.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 block mb-1",children:"Detalles / Daños:"}),e.jsx("ul",{className:"list-disc list-inside text-rose-500 font-medium",children:c.defects.map((a,s)=>e.jsx("li",{children:a},s))})]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-6 rounded-2xl text-left space-y-4",children:[e.jsxs("div",{className:"flex justify-between border-b border-slate-200 dark:border-slate-700 pb-3",children:[e.jsx("span",{className:"text-slate-500",children:"Vehículo"}),e.jsxs("span",{className:"font-bold",children:[t.year," ",t.make," ",t.model]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Válido por"}),e.jsx("span",{className:"font-bold text-[#00aed9]",children:"7 Días"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:async()=>{try{await Q({firstName:"Usuario",lastName:"Invitado",type:"trade-in",vehicleInfo:t,offerAmount:w,tradeInPhotos:O,status:"new",aiSummary:c?`IA Condition: ${c.condition}. Reasoning: ${c.reasoning}`:"No AI Analysis"}),u("/garage")}catch(a){console.error(a),alert("Error guardando la oferta.")}},className:"w-full py-4 bg-[#0d2232] text-white rounded-xl font-bold uppercase tracking-widest shadow-xl active:scale-95 transition-all",children:"Aceptar Oferta y Agendar Cita"}),e.jsx("button",{onClick:()=>u("/"),className:"w-full py-4 text-slate-400 font-bold uppercase tracking-widest text-xs hover:text-slate-600",children:"Lo pensaré"})]})]},"offer")}};return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-slate-900 p-6 pb-24",children:[e.jsxs("header",{className:"flex items-center gap-4 mb-8",children:[e.jsx("button",{onClick:()=>u(-1),className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center",children:e.jsx(S,{className:"rotate-180",size:20})}),e.jsxs("h1",{className:"text-2xl font-black uppercase italic tracking-tighter",children:["Vender mi ",e.jsx("span",{className:"text-[#00aed9]",children:"Auto"})]})]}),e.jsx(H,{mode:"wait",children:M()})]})};export{oe as default};
