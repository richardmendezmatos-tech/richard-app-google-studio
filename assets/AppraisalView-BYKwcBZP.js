import{r as a,j as e,a4 as Q,u as Y,b as T,M as F,S as Z,t as ee,a5 as te,a6 as se,a7 as ae,a8 as ne}from"./index-BeqFQMH-.js";import{M as le,i as re,u as _,P as oe,a as ie,b as ce,L as de,m as C}from"./proxy-C9p-T2pU.js";function B(t,o){if(typeof t=="function")return t(o);t!=null&&(t.current=o)}function ue(...t){return o=>{let n=!1;const l=t.map(d=>{const s=B(d,o);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let d=0;d<l.length;d++){const s=l[d];typeof s=="function"?s():B(t[d],null)}}}}function pe(...t){return a.useCallback(ue(...t),t)}class xe extends a.Component{getSnapshotBeforeUpdate(o){const n=this.props.childRef.current;if(n&&o.isPresent&&!this.props.isPresent){const l=n.offsetParent,d=re(l)&&l.offsetWidth||0,s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft,s.right=d-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function fe({children:t,isPresent:o,anchorX:n,root:l}){const d=a.useId(),s=a.useRef(null),m=a.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:y}=a.useContext(le),x=pe(s,t?.ref);return a.useInsertionEffect(()=>{const{width:p,height:j,top:r,left:f,right:i}=m.current;if(o||!s.current||!p||!j)return;const N=n==="left"?`left: ${f}`:`right: ${i}`;s.current.dataset.motionPopId=d;const c=document.createElement("style");y&&(c.nonce=y);const P=l??document.head;return P.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${d}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${j}px !important;
            ${N}px !important;
            top: ${r}px !important;
          }
        `),()=>{P.contains(c)&&P.removeChild(c)}},[o]),e.jsx(xe,{isPresent:o,childRef:s,sizeRef:m,children:a.cloneElement(t,{ref:x})})}const he=({children:t,initial:o,isPresent:n,onExitComplete:l,custom:d,presenceAffectsLayout:s,mode:m,anchorX:y,root:x})=>{const p=_(me),j=a.useId();let r=!0,f=a.useMemo(()=>(r=!1,{id:j,initial:o,isPresent:n,custom:d,onExitComplete:i=>{p.set(i,!0);for(const N of p.values())if(!N)return;l&&l()},register:i=>(p.set(i,!1),()=>p.delete(i))}),[n,p,l]);return s&&r&&(f={...f}),a.useMemo(()=>{p.forEach((i,N)=>p.set(N,!1))},[n]),a.useEffect(()=>{!n&&!p.size&&l&&l()},[n]),m==="popLayout"&&(t=e.jsx(fe,{isPresent:n,anchorX:y,root:x,children:t})),e.jsx(oe.Provider,{value:f,children:t})};function me(){return new Map}const $=t=>t.key||"";function K(t){const o=[];return a.Children.forEach(t,n=>{a.isValidElement(n)&&o.push(n)}),o}const be=({children:t,custom:o,initial:n=!0,onExitComplete:l,presenceAffectsLayout:d=!0,mode:s="sync",propagate:m=!1,anchorX:y="left",root:x})=>{const[p,j]=ie(m),r=a.useMemo(()=>K(t),[t]),f=m&&!p?[]:r.map($),i=a.useRef(!0),N=a.useRef(r),c=_(()=>new Map),[P,I]=a.useState(r),[v,M]=a.useState(r);ce(()=>{i.current=!1,N.current=r;for(let b=0;b<v.length;b++){const h=$(v[b]);f.includes(h)?c.delete(h):c.get(h)!==!0&&c.set(h,!1)}},[v,f.length,f.join("-")]);const R=[];if(r!==P){let b=[...r];for(let h=0;h<v.length;h++){const k=v[h],A=$(k);f.includes(A)||(b.splice(h,0,k),R.push(k))}return s==="wait"&&R.length&&(b=R),M(K(b)),I(r),null}const{forceRender:S}=a.useContext(de);return e.jsx(e.Fragment,{children:v.map(b=>{const h=$(b),k=m&&!p?!1:r===v||f.includes(h),A=()=>{if(c.has(h))c.set(h,!0);else return;let z=!0;c.forEach(U=>{U||(z=!1)}),z&&(S?.(),M(N.current),m&&j?.(),l&&l())};return e.jsx(he,{isPresent:k,initial:!i.current||n?void 0:!1,custom:o,presenceAffectsLayout:d,mode:s,root:x,onExitComplete:k?void 0:A,anchorX:y,children:b},h)})})},ge=(t={})=>{const[o,n]=a.useState(t),[l,d]=a.useState(!1),[s,m]=a.useState(null),y=(r,f)=>{n(i=>({...i,[r]:f}))},x=async()=>{d(!0),m(null);try{const r=Object.values(o).map(async i=>i?await Q(i):null);return(await Promise.all(r)).filter(i=>i!==null)}catch(r){throw console.error("Upload failed",r),m("Error subiendo las imágenes."),r}finally{d(!1)}},p=()=>Object.values(o).filter(Boolean).length,j=r=>p()>=r;return{photos:o,setPhoto:y,uploadAllPhotos:x,uploading:l,error:s,count:p(),isComplete:j}},ve=()=>{const t=Y(),[o,n]=a.useState("info"),[l,d]=a.useState({year:"",make:"",model:"",mileage:"",condition:"good",vin:""}),{photos:s,setPhoto:m,uploadAllPhotos:y,count:x}=ge({front:null,back:null,interior:null,dashboard:null}),[p,j]=a.useState(!1),[r,f]=a.useState(""),[i,N]=a.useState(!1),[c,P]=a.useState(null),[I,v]=a.useState({min:0,max:0}),[M,R]=a.useState([]),S=u=>{d({...l,[u.target.name]:u.target.value})},b=(u,g)=>{g.target.files&&g.target.files[0]&&m(u,g.target.files[0])},k=x/4*100,A=u=>new Promise((g,V)=>{const E=new FileReader;E.readAsDataURL(u),E.onload=()=>g(E.result),E.onerror=L=>V(L)}),z=async()=>{j(!0),f("Subiendo fotos...");try{const g=["front","back","interior","dashboard"].map(w=>s[w]).filter(w=>w!==null);if(g.length<4)throw new Error("Missing photos");const V=g.map(w=>A(w)),L=(await Promise.all(V)).map(w=>w.split(",")[1]);f("Analizando Carrocería con IA...");const H=y(),W=ne(L),G=new Promise(w=>setTimeout(w,3500)),[q,O,je]=await Promise.all([H,W,G]);R(q),P(O);const D=15e3,X=Math.round(D*O.estimatedValueAdjustment),J=Math.round((D+2500)*O.estimatedValueAdjustment);v({min:X,max:J}),N(!0)}catch(u){console.error("Scan/Upload failed",u),alert("Hubo un error al procesar las imágenes. Por favor intenta de nuevo.")}finally{j(!1)}},U=()=>{switch(o){case"info":return e.jsxs(C.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white mb-6",children:"Detalles del Vehículo"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Año"}),e.jsx("input",{type:"number",name:"year",value:l.year,onChange:S,className:"w-full bg-slate-100 dark:bg-slate-700 p-3 rounded-xl outline-none focus:ring-2 focus:ring-[#00aed9]",placeholder:"2018"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Marca"}),e.jsx("input",{type:"text",name:"make",value:l.make,onChange:S,className:"w-full bg-slate-100 dark:bg-slate-700 p-3 rounded-xl outline-none focus:ring-2 focus:ring-[#00aed9]",placeholder:"Toyota"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Modelo"}),e.jsx("input",{type:"text",name:"model",value:l.model,onChange:S,className:"w-full bg-slate-100 dark:bg-slate-700 p-3 rounded-xl outline-none focus:ring-2 focus:ring-[#00aed9]",placeholder:"Camry SE"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Kilometraje"}),e.jsx("input",{type:"number",name:"mileage",value:l.mileage,onChange:S,className:"w-full bg-slate-100 dark:bg-slate-700 p-3 rounded-xl outline-none focus:ring-2 focus:ring-[#00aed9]",placeholder:"45000"})]})]}),e.jsxs("button",{onClick:()=>n("photos"),className:"w-full py-4 bg-[#00aed9] text-white rounded-xl font-bold uppercase tracking-widest shadow-lg shadow-cyan-500/20 active:scale-95 transition-transform flex items-center justify-center gap-2",children:["Siguiente Paso ",e.jsx(T,{size:18})]})]},"info");case"photos":return e.jsxs(C.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Fotos del Vehículo"}),e.jsxs("span",{className:`text-xs font-black uppercase px-2 py-1 rounded-lg ${x===4?"bg-emerald-500/10 text-emerald-500":"bg-slate-100 dark:bg-slate-800 text-slate-500"}`,children:["Fotos: ",x,"/4"]})]}),e.jsx("div",{className:"w-full bg-slate-100 dark:bg-slate-800 h-2 rounded-full overflow-hidden mb-6",children:e.jsx("div",{className:`h-full transition-all duration-500 ${x===4?"bg-emerald-500":"bg-[#00aed9]"}`,style:{width:`${k}%`}})}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.keys(s).map(u=>e.jsxs("label",{className:`aspect-square rounded-2xl border-2 border-dashed flex flex-col items-center justify-center cursor-pointer transition-all relative overflow-hidden group ${s[u]?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/20":"border-slate-300 dark:border-slate-700 hover:border-[#00aed9] hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[s[u]?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:URL.createObjectURL(s[u]),className:"absolute inset-0 w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"bg-white/20 backdrop-blur-md p-2 rounded-full",children:e.jsx(F,{className:"text-white drop-shadow-md",size:32})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"text-slate-400 mb-2 group-hover:text-[#00aed9] group-hover:scale-110 transition-all",size:24}),e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-400",children:u})]}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:g=>b(u,g)})]},u))}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl flex gap-3 text-blue-600 dark:text-blue-300 text-xs",children:[e.jsx(ae,{className:"shrink-0",size:16}),e.jsx("p",{children:"Toma fotos claras y bien iluminadas para obtener la mejor oferta posible."})]}),e.jsxs("button",{onClick:()=>{x===4&&n("scan")},disabled:x<4,className:"w-full py-4 bg-[#00aed9] disabled:bg-slate-300 disabled:cursor-not-allowed text-white rounded-xl font-bold uppercase tracking-widest shadow-lg shadow-cyan-500/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[x<4?`Faltan Fotos(${x}/4)`:"Analizar Vehículo",x===4&&e.jsx(T,{size:18})]})]},"photos");case"scan":return e.jsxs(C.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"flex flex-col items-center justify-center py-10 space-y-8",children:[e.jsxs("div",{className:"relative w-64 h-64",children:[e.jsx(C.div,{animate:{rotate:360},transition:{duration:4,repeat:1/0,ease:"linear"},className:"absolute inset-0 border-4 border-dashed border-[#00aed9]/30 rounded-full"}),e.jsx(C.div,{animate:{rotate:-360},transition:{duration:3,repeat:1/0,ease:"linear"},className:"absolute inset-4 border-4 border-dashed border-[#00aed9]/50 rounded-full"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(te,{className:"text-[#00aed9] w-24 h-24 opacity-80 animate-pulse"})}),e.jsx(C.div,{animate:{top:["0%","100%","0%"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"absolute left-0 right-0 h-1 bg-[#00aed9] shadow-[0_0_20px_#00aed9]"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-2xl font-black uppercase text-slate-800 dark:text-white animate-pulse",children:i?"Análisis Completado":r||"Iniciando Escáner..."}),e.jsx("p",{className:"text-sm text-slate-500",children:i?"Generando tu oferta final...":"Nuestra IA está detectando daños y condiciones."})]}),!p&&!i&&e.jsx("button",{onClick:z,className:"px-8 py-3 bg-[#0d2232] text-white rounded-full font-bold uppercase tracking-widest text-xs animate-in fade-in slide-in-from-bottom-4",children:"Iniciar Escaneo IA"}),i&&e.jsx(C.button,{initial:{scale:0},animate:{scale:1},onClick:()=>n("offer"),className:"px-8 py-4 bg-emerald-500 text-white rounded-full font-black uppercase tracking-widest text-sm shadow-xl shadow-emerald-500/30 hover:scale-105 transition-transform",children:"Ver Oferta"})]},"scan");case"offer":return e.jsxs(C.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"text-center space-y-8 py-6",children:[e.jsx("div",{className:"inline-block p-4 bg-emerald-100 dark:bg-emerald-900/30 rounded-full text-emerald-600 mb-4",children:e.jsx(F,{size:48})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest mb-2",children:"Oferta Estimada"}),e.jsxs("div",{className:"text-5xl font-black text-slate-900 dark:text-white tracking-tighter",children:["$",I.min.toLocaleString()," - $",I.max.toLocaleString()]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-6 rounded-2xl text-left space-y-4 shadow-inner border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"text-amber-400",size:20,fill:"currentColor"}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:"Reporte de Inspección IA"})]}),c&&e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Condición Detectada:"}),e.jsx("span",{className:"font-bold px-2 py-0.5 rounded bg-slate-200 dark:bg-slate-700 uppercase text-xs",children:c.condition})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 block mb-1",children:"Observaciones:"}),e.jsxs("p",{className:"text-slate-700 dark:text-slate-300 italic",children:['"',c.reasoning,'"']})]}),c.defects.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 block mb-1",children:"Detalles / Daños:"}),e.jsx("ul",{className:"list-disc list-inside text-rose-500 font-medium",children:c.defects.map((u,g)=>e.jsx("li",{children:u},g))})]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-6 rounded-2xl text-left space-y-4",children:[e.jsxs("div",{className:"flex justify-between border-b border-slate-200 dark:border-slate-700 pb-3",children:[e.jsx("span",{className:"text-slate-500",children:"Vehículo"}),e.jsxs("span",{className:"font-bold",children:[l.year," ",l.make," ",l.model]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Válido por"}),e.jsx("span",{className:"font-bold text-[#00aed9]",children:"7 Días"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:async()=>{try{await ee({firstName:"Usuario",lastName:"Invitado",type:"trade-in",vehicleInfo:l,offerAmount:I,tradeInPhotos:M,status:"new",aiSummary:c?`IA Condition: ${c.condition}. Reasoning: ${c.reasoning}`:"No AI Analysis"}),t("/garage")}catch(u){console.error(u),alert("Error guardando la oferta.")}},className:"w-full py-4 bg-[#0d2232] text-white rounded-xl font-bold uppercase tracking-widest shadow-xl active:scale-95 transition-all",children:"Aceptar Oferta y Agendar Cita"}),e.jsx("button",{onClick:()=>t("/"),className:"w-full py-4 text-slate-400 font-bold uppercase tracking-widest text-xs hover:text-slate-600",children:"Lo pensaré"})]})]},"offer")}};return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-slate-900 p-6 pb-24",children:[e.jsxs("header",{className:"flex items-center gap-4 mb-8",children:[e.jsx("button",{onClick:()=>t(-1),className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center",children:e.jsx(T,{className:"rotate-180",size:20})}),e.jsxs("h1",{className:"text-2xl font-black uppercase italic tracking-tighter",children:["Vender mi ",e.jsx("span",{className:"text-[#00aed9]",children:"Auto"})]})]}),e.jsx(be,{mode:"wait",children:U()})]})};export{ve as default};
